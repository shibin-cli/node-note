"use strict";(self.webpackChunknode_note=self.webpackChunknode_note||[]).push([[79],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),u=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(p.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),h=u(n),d=a,m=h["".concat(p,".").concat(d)]||h[d]||l[d]||o;return n?r.createElement(m,i(i({ref:t},c),{},{components:n})):r.createElement(m,i({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6706:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return p},metadata:function(){return u},toc:function(){return c},default:function(){return h}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={sidebar_position:4},p="koa-router",u={unversionedId:"koa/router",id:"koa/router",title:"koa-router",description:"\u4f7f\u7528",source:"@site/docs/koa/router.md",sourceDirName:"koa",slug:"/koa/router",permalink:"/node-note/docs/koa/router",editUrl:"https://github.com/shibin-cli/node-note/tree/master/packages/create-docusaurus/templates/shared/docs/koa/router.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Koa \u7684\u5b9e\u73b0",permalink:"/node-note/docs/koa/mykoa"},next:{title:"Monorepo",permalink:"/node-note/docs/cli/monorepo"}},c=[{value:"\u4f7f\u7528",id:"\u4f7f\u7528",children:[],level:2},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",children:[],level:2}],l={toc:c};function h(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"koa-router"},"koa-router"),(0,o.kt)("h2",{id:"\u4f7f\u7528"},"\u4f7f\u7528"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"var Koa = require('koa')\nvar Router = require('koa-router')\n\nvar app = new Koa()\nvar router = new Router()\n\nrouter.get('/', (ctx, next) => {\n  // ctx.router available\n})\nrouter.get('/:category/:title', (ctx, next) => {\n  console.log(ctx.params)\n  // => { category: 'programming', title: 'how-to-node' }\n})\napp.use(router.routes()).use(router.allowedMethods())\n")),(0,o.kt)("h2",{id:"\u5b9e\u73b0"},"\u5b9e\u73b0"),(0,o.kt)("p",null,"\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"route.get('/xxx', middleware)"),"\u3001",(0,o.kt)("inlineCode",{parentName:"p"},"route.post('/xxx', middleware)"),"\u7b49\u65f6,\u4f1a\u5c06\u6ce8\u518c\u7684\u65b9\u6cd5\u548c\u4e2d\u95f4\u952e\u90fd\u4fdd\u5b58\u8d77\u6765"),(0,o.kt)("p",null,"\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"app.use(router.routes())"),"\u540e\uff0c\u5f53\u6709\u8bf7\u6c42\u8fc7\u6765\u65f6\uff0c\u5c31\u4f1a\u5904\u7406\u6211\u4eec\u6ce8\u518c\u7684\u8def\u7531\uff0c\u5f53\u8bbf\u95ee\u8def\u5f84\u548c\u65b9\u6cd5\u90fd\u5339\u914d\u65f6\uff0c\u5c31\u6267\u884c\u8be5\u4e2d\u95f4\u952e"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"router.get('/', (ctx, next) => {\n  // ctx.router available\n})\nrouter.get('/aa', middleware)\napp.use(router.routes())\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"class Router {\n  routes() {\n    return async (ctx, next) => {\n      for (let i = 0, len = stack.length; i < len; i++) {\n        const routeItem = stack[i]\n        // \u65b9\u6cd5\u548c\u8def\u5f84\u90fd\u5339\u914d\n        if (routeItem.path === ctx.path && routeItem.method === ctx.method) {\n          route = stack[i].middleware\n          route(ctx, next)\n          break\n        }\n      }\n      await next()\n    }\n  }\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"class Layer {\n  constructor(path, methods, middleware, opts) {\n    this.path = path\n    this.methods = methods\n    this.middleware = middleware\n  }\n}\nclass Router {\n  constructor() {\n    this.methods = ['HEAD', 'OPTIONS', 'GET', 'PUT', 'PATCH', 'POST', 'DELETE']\n    this.stack = []\n    this.initMethods()\n  }\n  initMethods() {\n    this.methods.forEach((method) => {\n      // \u5f53\u8c03\u7528router.get...,\u5c31\u662f\u6ce8\u518c\u8def\u7531\n      this[method] = this[method.toLowerCase()] = (path, middleware) => {\n        this.register(path, [method], middleware)\n      }\n    })\n  }\n  // \u8def\u7531\u6ce8\u518c\uff0c\u4f1a\u5c06\u65b9\u6cd5\u548c\u4e2d\u95f4\u952e\u4fdd\u5b58\u4e0b\u6765\n  register(path, methods, middleware, opts) {\n    let route = new Layer(path, methods, middleware, opts)\n    this.stack.push(route)\n    return this\n  }\n  routes() {\n    return async (ctx, next) => {\n      let stack = this.stack\n      let route\n      for (let i = 0, len = stack.length; i < len; i++) {\n        const routeItem = stack[i]\n        if (\n          routeItem.path === ctx.path &&\n          routeItem.methods.indexOf(ctx.method) > -1\n        ) {\n          route = stack[i].middleware\n          break\n        }\n      }\n      if (typeof route === 'function') {\n        route(ctx, next)\n      }\n      await next()\n    }\n  }\n}\n")),(0,o.kt)("p",null,"\u4e0b\u9762\u5b9e\u73b0\u52a8\u6001\u8def\u7531"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u601d\u8def\u5c31\u662f\u6839\u636e\u6ce8\u518c\u7684\u8def\u7531\u751f\u4ea7\u52a8\u6001\u6b63\u5219",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"/a/:id \u751f\u6210\u6b63\u5219",(0,o.kt)("inlineCode",{parentName:"li"},"/^\\/a\\/([^/]+?)[/]?$/"),"\uff0c\u5e76\u4fdd\u5b58\u52a8\u6001\u7684\u952e",(0,o.kt)("inlineCode",{parentName:"li"},"[id]")),(0,o.kt)("li",{parentName:"ul"},"\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u6839\u636e\u6b63\u5219\u53bb\u5339\u914d\uff0c\u83b7\u53d6\u5bf9\u5e94 id \u7684\u503c\uff0c\u5e76\u5c06\u503c\u6dfb\u52a0\u5230\u4e0a\u4e0b\u6587\u5bf9\u8c61\u4e0a,\u5982",(0,o.kt)("inlineCode",{parentName:"li"},"{id: 1}"))))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"class Layer {\n  constructor(path, methods, middleware, opts) {\n    this.path = path\n    this.methods = methods\n    this.middleware = middleware\n    this.pathRegStrList = []\n    this.pathPramsKeyList = []\n    this.initPathToRegxExpConfig(path)\n  }\n  // \u751f\u4ea7\u52a8\u6001\u6b63\u5219\u548c\u53c2\u6570\n  initPathToRegxExpConfig(path) {\n    const pathItemReg = /\\/([^\\/]{2,})/g\n    const paramsKeyReg = /\\/\\:([\\w\\_]+)/\n    // \u6240\u6709\u5730\u5740\n    const pathItems = path.match(pathItemReg)\n    // \u7528\u6765\u4fdd\u5b58\u52a8\u6001\u5730\u5740\n    const pathPramsKeyList = []\n    // \u8def\u5f84\u5339\u914d\u6b63\u5219\u6570\u7ec4\n    const pathRegList = []\n    if (Array.isArray(pathItems)) {\n      pathItems.forEach((path) => {\n        if (paramsKeyReg.test(path)) {\n          pathRegList.push(`/([^\\/]+?)`)\n          pathPramsKeyList.push(path.replace(/\\/\\:/g, ''))\n        } else {\n          pathRegList.push(path)\n        }\n      })\n    }\n    this.pathPramsKeyList = pathPramsKeyList\n    this.pathReg = new RegExp(`^${pathRegList.join('')}[\\/]?$`)\n  }\n  match(path, method) {\n    return this.methods.indexOf(method) > -1 && this.pathReg.test(path)\n  }\n  getParams(path) {\n    const execRes = this.pathReg.exec(path)\n    if (!execRes) {\n      return {}\n    }\n    const res = {}\n    this.pathPramsKeyList.forEach((item, index) => {\n      res[item] = execRes[index + 1]\n    })\n    return res\n  }\n}\n")))}h.isMDXComponent=!0}}]);