"use strict";(self.webpackChunknode_note=self.webpackChunknode_note||[]).push([[691],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=r.createContext({}),i=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=i(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,l=e.mdxType,a=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=i(n),m=l,g=d["".concat(s,".").concat(m)]||d[m]||u[m]||a;return n?r.createElement(g,o(o({ref:t},c),{},{components:n})):r.createElement(g,o({ref:t},c))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var a=n.length,o=new Array(a);o[0]=d;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:l,o[1]=p;for(var i=2;i<a;i++)o[i]=n[i];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8716:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return p},contentTitle:function(){return s},metadata:function(){return i},toc:function(){return c},default:function(){return d}});var r=n(7462),l=n(3366),a=(n(7294),n(3905)),o=["components"],p={},s="\u4f7f\u7528\u57fa\u7840",i={unversionedId:"egg/start",id:"egg/start",title:"\u4f7f\u7528\u57fa\u7840",description:"Egg.js \u662f\u57fa\u4e8e Koa \u5f00\u53d1\uff0c\u4e3a\u4f01\u4e1a\u7ea7\u6846\u67b6\u548c\u5e94\u7528\u800c\u751f",source:"@site/docs/egg/start.md",sourceDirName:"egg",slug:"/egg/start",permalink:"/node-note/docs/egg/start",editUrl:"https://github.com/shibin-cli/node-note/tree/master/packages/create-docusaurus/templates/shared/docs/egg/start.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"MongoDB",permalink:"/node-note/docs/db/mongodb"}},c=[{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",children:[],level:2},{value:"\u4f7f\u7528\u811a\u624b\u67b6\u521b\u5efa\u9879\u76ee",id:"\u4f7f\u7528\u811a\u624b\u67b6\u521b\u5efa\u9879\u76ee",children:[],level:2},{value:"\u624b\u52a8\u521b\u5efa\u9879\u76ee",id:"\u624b\u52a8\u521b\u5efa\u9879\u76ee",children:[{value:"\u7f16\u5199 Controller",id:"\u7f16\u5199-controller",children:[],level:3},{value:"\u7f16\u5199 Router",id:"\u7f16\u5199-router",children:[],level:3},{value:"\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6",id:"\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6",children:[],level:3}],level:2},{value:"\u76ee\u5f55\u7ed3\u6784",id:"\u76ee\u5f55\u7ed3\u6784",children:[],level:2},{value:"\u5185\u7f6e\u5bf9\u8c61",id:"\u5185\u7f6e\u5bf9\u8c61",children:[{value:"Application",id:"application",children:[{value:"\u4e8b\u4ef6",id:"\u4e8b\u4ef6",children:[],level:4}],level:3},{value:"\u83b7\u53d6\u65b9\u5f0f",id:"\u83b7\u53d6\u65b9\u5f0f",children:[],level:3},{value:"Context",id:"context",children:[],level:3},{value:"\u83b7\u53d6\u65b9\u5f0f",id:"\u83b7\u53d6\u65b9\u5f0f-1",children:[],level:3},{value:"Request &amp; Response",id:"request--response",children:[],level:3},{value:"Controller",id:"controller",children:[],level:3},{value:"Service",id:"service",children:[],level:3},{value:"Helper",id:"helper",children:[],level:3}],level:2}],u={toc:c};function d(e){var t=e.components,n=(0,l.Z)(e,o);return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u4f7f\u7528\u57fa\u7840"},"\u4f7f\u7528\u57fa\u7840"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn"},"Egg.js")," \u662f\u57fa\u4e8e ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/koajs/koa"},"Koa")," \u5f00\u53d1\uff0c\u4e3a\u4f01\u4e1a\u7ea7\u6846\u67b6\u548c\u5e94\u7528\u800c\u751f"),(0,a.kt)("p",null,"Egg \u5949\u884c ",(0,a.kt)("strong",{parentName:"p"},"\u300e\u7ea6\u5b9a\u4f18\u4e8e\u914d\u7f6e\u300f"),"\uff0c\u6309\u7167\u4e00\u5957 ",(0,a.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/advanced/loader.html"},"\u7edf\u4e00\u7684\u7ea6\u5b9a")," \u8fdb\u884c\u5e94\u7528\u5f00\u53d1\uff0c\u56e2\u961f\u5185\u90e8\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u51cf\u5c11\u5f00\u53d1\u4eba\u5458\u7684\u5b66\u4e60\u6210\u672c\uff0c\u5f00\u53d1\u4eba\u5458\u4e0d\u518d\u662f\u300e\u9489\u5b50\u300f\uff0c\u53ef\u4ee5\u6d41\u52a8\u8d77\u6765\u3002\u540c\u65f6\u8fd8\u6709\u5f88\u9ad8\u7684\u6269\u5c55\u6027\uff0c\u53ef\u4ee5\u6309\u7167\u56e2\u961f\u7684\u7ea6\u5b9a\u5b9a\u5236\u6846\u67b6\u3002\u4f7f\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/advanced/loader.html"},"Loader")," \u53ef\u4ee5\u8ba9\u6846\u67b6\u6839\u636e\u4e0d\u540c\u73af\u5883\u5b9a\u4e49\u9ed8\u8ba4\u914d\u7f6e\uff0c\u8fd8\u53ef\u4ee5\u8986\u76d6 Egg \u7684\u9ed8\u8ba4\u7ea6\u5b9a\u3002"),(0,a.kt)("p",null,"\u66f4\u591a\u4ecb\u7ecd\u67e5\u770b ",(0,a.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/intro/index.html"},"Egg.js \u662f\u4ec0\u4e48")),(0,a.kt)("h2",{id:"\u5feb\u901f\u5f00\u59cb"},"\u5feb\u901f\u5f00\u59cb"),(0,a.kt)("p",null,"\u67e5\u770b ",(0,a.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/intro/quickstart.html"},"\u5b98\u7f51\u6587\u6863")),(0,a.kt)("h2",{id:"\u4f7f\u7528\u811a\u624b\u67b6\u521b\u5efa\u9879\u76ee"},"\u4f7f\u7528\u811a\u624b\u67b6\u521b\u5efa\u9879\u76ee"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pnpm init egg --type=simple\npnpm i\nnpm run dev\n# \u6253\u5f00 http://127.0.0.1:7001\n")),(0,a.kt)("h2",{id:"\u624b\u52a8\u521b\u5efa\u9879\u76ee"},"\u624b\u52a8\u521b\u5efa\u9879\u76ee"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir egg-example\ncd egg-example\nnpm init\nnpm i egg\nnpm i egg-bin -D\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "egg-example",\n  "scripts": {\n    "dev": "egg-bin dev"\n  }\n}\n')),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u719f\u6089 Web \u5f00\u53d1\u6216 MVC\uff0c\u80af\u5b9a\u731c\u5230\u6211\u4eec\u7b2c\u4e00\u6b65\u9700\u8981\u7f16\u5199\u7684\u662f Controller \u548c Router\u3002"),(0,a.kt)("h3",{id:"\u7f16\u5199-controller"},"\u7f16\u5199 Controller"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/controller/home.js\nconst Controller = require('egg').Controller\n\nclass HomeController extends Controller {\n  async index() {\n    this.ctx.body = 'Hello world'\n  }\n}\n\nmodule.exports = HomeController\n")),(0,a.kt)("h3",{id:"\u7f16\u5199-router"},"\u7f16\u5199 Router"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app\n  router.get('/', controller.home.index)\n}\n")),(0,a.kt)("h3",{id:"\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6"},"\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// config/config.default.js\nexports.keys = <\u6b64\u5904\u6539\u4e3a\u4f60\u81ea\u5df1\u7684 Cookie \u5b89\u5168\u5b57\u7b26\u4e32>;\n")),(0,a.kt)("p",null,"\u521b\u5efa\u4e4b\u540e\u4f60\u7684\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"egg-example\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 controller\n\u2502   \u2502   \u2514\u2500\u2500 home.js\n\u2502   \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 config\n\u2502   \u2514\u2500\u2500 config.default.js\n\u2514\u2500\u2500 package.json\n")),(0,a.kt)("p",null,"\u7136\u540e\u8fd0\u884c\u542f\u52a8\u547d\u4ee4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm run dev\n# \u6253\u5f00 http://localhost:7001\n")),(0,a.kt)("p",null,"\u7136\u540e\u521b\u5efa\u5176\u4ed6\u76ee\u5f55\u7ed3\u6784\uff0c\u53c2\u8003 ",(0,a.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/intro/quickstart.html#%E9%80%90%E6%AD%A5%E6%90%AD%E5%BB%BA"},"\u6587\u6863")),(0,a.kt)("h2",{id:"\u76ee\u5f55\u7ed3\u6784"},"\u76ee\u5f55\u7ed3\u6784"),(0,a.kt)("p",null,"\u6846\u67b6\u76ee\u5f55\u53ef\u4ee5\u53c2\u8003 ",(0,a.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/basics/structure.html"},"egg \u5b98\u65b9\u6587\u6863")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/router.js")," \u7528\u4e8e\u914d\u7f6e URL \u8def\u7531\u89c4\u5219\uff0c\u5177\u4f53\u53c2\u89c1 ",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/basics/router.html"},"Router"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/controller/**")," \u7528\u4e8e\u89e3\u6790\u7528\u6237\u7684\u8f93\u5165\uff0c\u5904\u7406\u540e\u8fd4\u56de\u76f8\u5e94\u7684\u7ed3\u679c\uff0c\u5177\u4f53\u53c2\u89c1 ",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/basics/controller.html"},"Controller"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/service/**")," \u7528\u4e8e\u7f16\u5199\u4e1a\u52a1\u903b\u8f91\u5c42\uff0c\u53ef\u9009\uff0c\u5efa\u8bae\u4f7f\u7528\uff0c\u5177\u4f53\u53c2\u89c1 ",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/basics/service.html"},"Service"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/middleware/**")," \u7528\u4e8e\u7f16\u5199\u4e2d\u95f4\u4ef6\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1 ",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/basics/middleware.html"},"Middleware"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/public/**")," \u7528\u4e8e\u653e\u7f6e\u9759\u6001\u8d44\u6e90\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1\u5185\u7f6e\u63d2\u4ef6 ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/eggjs/egg-static"},"egg-static"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/extend/**")," \u7528\u4e8e\u6846\u67b6\u7684\u6269\u5c55\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/basics/extend.html"},"\u6846\u67b6\u6269\u5c55"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"config/config.{env}.js")," \u7528\u4e8e\u7f16\u5199\u914d\u7f6e\u6587\u4ef6\uff0c\u5177\u4f53\u53c2\u89c1",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/basics/config.html"},"\u914d\u7f6e"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"config/plugin.js")," \u7528\u4e8e\u914d\u7f6e\u9700\u8981\u52a0\u8f7d\u7684\u63d2\u4ef6\uff0c\u5177\u4f53\u53c2\u89c1",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/basics/plugin.html"},"\u63d2\u4ef6"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"test/**")," \u7528\u4e8e\u5355\u5143\u6d4b\u8bd5\uff0c\u5177\u4f53\u53c2\u89c1",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/core/unittest.html"},"\u5355\u5143\u6d4b\u8bd5"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app.js")," \u548c ",(0,a.kt)("inlineCode",{parentName:"li"},"agent.js")," \u7528\u4e8e\u81ea\u5b9a\u4e49\u542f\u52a8\u65f6\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1\u542f\u52a8\u81ea\u5b9a\u4e49\u3002\u5173\u4e8e ",(0,a.kt)("inlineCode",{parentName:"li"},"agent.js")," \u7684\u4f5c\u7528\u53c2\u89c1 ",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/core/cluster-and-ipc.html#agent-%E6%9C%BA%E5%88%B6"},"Agent \u673a\u5236"),"\u3002")),(0,a.kt)("p",null,"\u7531\u5185\u7f6e\u63d2\u4ef6\u7ea6\u5b9a\u7684\u76ee\u5f55\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/public/**")," \u7528\u4e8e\u653e\u7f6e\u9759\u6001\u8d44\u6e90\uff0c\u53ef\u9009\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/schedule/**")," \u7528\u4e8e\u5b9a\u65f6\u4efb\u52a1\uff0c\u53ef\u9009\u3002")),(0,a.kt)("p",null,"\u82e5\u9700\u81ea\u5b9a\u4e49\u81ea\u5df1\u7684\u76ee\u5f55\u89c4\u8303\uff0c\u53c2\u89c1 ",(0,a.kt)("a",{parentName:"p",href:"https://eggjs.org/zh-cn/advanced/loader.html"},"Loader API")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/view/**")," \u7528\u4e8e\u653e\u7f6e\u6a21\u677f\u6587\u4ef6\uff0c\u53ef\u9009\uff0c\u7531\u6a21\u677f\u63d2\u4ef6\u7ea6\u5b9a\uff0c\u5177\u4f53\u53c2\u89c1",(0,a.kt)("a",{parentName:"li",href:"https://eggjs.org/zh-cn/core/view.html"},"\u6a21\u677f\u6e32\u67d3"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"app/model/**")," \u7528\u4e8e\u653e\u7f6e\u9886\u57df\u6a21\u578b\uff0c\u53ef\u9009\uff0c\u7531\u9886\u57df\u7c7b\u76f8\u5173\u63d2\u4ef6\u7ea6\u5b9a\uff0c\u5982 ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize"),"\u3002")),(0,a.kt)("h2",{id:"\u5185\u7f6e\u5bf9\u8c61"},"\u5185\u7f6e\u5bf9\u8c61"),(0,a.kt)("p",null,"\u6846\u67b6\u4e2d\u5185\u7f6e\u7684\u4e00\u4e9b\u57fa\u7840\u5bf9\u8c61\uff0c\u5305\u62ec\u4ece Koa \u7ee7\u627f\u800c\u6765\u7684 4 \u4e2a\u5bf9\u8c61\uff08Application, Context, Request, Response) \u4ee5\u53ca\u6846\u67b6\u6269\u5c55\u7684\u4e00\u4e9b\u5bf9\u8c61\uff08Controller, Service, Helper, Config, Logger\uff09"),(0,a.kt)("h3",{id:"application"},"Application"),(0,a.kt)("p",null,"Application \u662f\u5168\u5c40\u5e94\u7528\u5bf9\u8c61\uff0c\u5728\u4e00\u4e2a\u5e94\u7528\u4e2d\uff0c\u53ea\u4f1a\u5b9e\u4f8b\u5316\u4e00\u4e2a\uff0c\u5b83\u7ee7\u627f\u81ea ",(0,a.kt)("inlineCode",{parentName:"p"},"Koa.Application"),"\uff0c\u5728\u5b83\u4e0a\u9762\u6211\u4eec\u53ef\u4ee5\u6302\u8f7d\u4e00\u4e9b\u5168\u5c40\u7684\u65b9\u6cd5\u548c\u5bf9\u8c61\u3002\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u7684\u5728\u63d2\u4ef6\u6216\u8005\u5e94\u7528\u4e2d\u6269\u5c55 Application \u5bf9\u8c61\u3002"),(0,a.kt)("h4",{id:"\u4e8b\u4ef6"},"\u4e8b\u4ef6"),(0,a.kt)("p",null,"\u5728\u6846\u67b6\u8fd0\u884c\u65f6\uff0c\u4f1a\u5728 Application \u5b9e\u4f8b\u4e0a\u89e6\u53d1\u4e00\u4e9b\u4e8b\u4ef6\uff0c\u5e94\u7528\u5f00\u53d1\u8005\u6216\u8005\u63d2\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u76d1\u542c\u8fd9\u4e9b\u4e8b\u4ef6\u505a\u4e00\u4e9b\u64cd\u4f5c\u3002\u4f5c\u4e3a\u5e94\u7528\u5f00\u53d1\u8005\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u5728\u542f\u52a8\u81ea\u5b9a\u4e49\u811a\u672c\u4e2d\u8fdb\u884c\u76d1\u542c"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"server: \u8be5\u4e8b\u4ef6\u4e00\u4e2a worker \u8fdb\u7a0b\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\uff0c\u5728 HTTP \u670d\u52a1\u5b8c\u6210\u542f\u52a8\u540e\uff0c\u4f1a\u5c06 HTTP server \u901a\u8fc7\u8fd9\u4e2a\u4e8b\u4ef6\u66b4\u9732\u51fa\u6765\u7ed9\u5f00\u53d1\u8005\u3002"),(0,a.kt)("li",{parentName:"ul"},"error: \u8fd0\u884c\u65f6\u6709\u4efb\u4f55\u7684\u5f02\u5e38\u88ab onerror \u63d2\u4ef6\u6355\u83b7\u540e\uff0c\u90fd\u4f1a\u89e6\u53d1 error \u4e8b\u4ef6\uff0c\u5c06\u9519\u8bef\u5bf9\u8c61\u548c\u5173\u8054\u7684\u4e0a\u4e0b\u6587\uff08\u5982\u679c\u6709\uff09\u66b4\u9732\u7ed9\u5f00\u53d1\u8005\uff0c\u53ef\u4ee5\u8fdb\u884c\u81ea\u5b9a\u4e49\u7684\u65e5\u5fd7\u8bb0\u5f55\u4e0a\u62a5\u7b49\u5904\u7406\u3002"),(0,a.kt)("li",{parentName:"ul"},"request \u548c response: \u5e94\u7528\u6536\u5230\u8bf7\u6c42\u548c\u54cd\u5e94\u8bf7\u6c42\u65f6\uff0c\u5206\u522b\u4f1a\u89e6\u53d1 request \u548c response \u4e8b\u4ef6\uff0c\u5e76\u5c06\u5f53\u524d\u8bf7\u6c42\u4e0a\u4e0b\u6587\u66b4\u9732\u51fa\u6765\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u76d1\u542c\u8fd9\u4e24\u4e2a\u4e8b\u4ef6\u6765\u8fdb\u884c\u65e5\u5fd7\u8bb0\u5f55\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app.js\nmodule.exports = (app) => {\n  app.once('server', (server) => {\n    // websocket\n  })\n  app.on('error', (err, ctx) => {\n    // report error\n  })\n  app.on('request', (ctx) => {\n    // log receive request\n  })\n  app.on('response', (ctx) => {\n    // ctx.starttime is set by framework\n    const used = Date.now() - ctx.starttime\n    // log total cost\n  })\n}\n")),(0,a.kt)("h3",{id:"\u83b7\u53d6\u65b9\u5f0f"},"\u83b7\u53d6\u65b9\u5f0f"),(0,a.kt)("p",null,"\u542f\u52a8\u81ea\u5b9a\u4e49\u811a\u672c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app.js\nmodule.exports = (app) => {\n  app.cache = new Cache()\n}\n")),(0,a.kt)("p",null,"controller \u4e2d\u83b7\u53d6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    this.ctx.body = this.app.cache.get(this.ctx.query.id)\n    // \u901a\u8fc7 ctx.app \u8bbf\u95ee\u5230 Application \u5bf9\u8c61 this.ctx.app.cache.get(this.ctx.query.id)\n    // this.ctx.body = this.ctx.app.cache.get(this.ctx.query.id)\n  }\n}\n")),(0,a.kt)("h3",{id:"context"},"Context"),(0,a.kt)("p",null,"Context \u662f\u4e00\u4e2a\u8bf7\u6c42\u7ea7\u522b\u7684\u5bf9\u8c61\uff0c\u7ee7\u627f\u81ea Koa.Context\u3002"),(0,a.kt)("p",null,"\u5728\u6bcf\u4e00\u6b21\u6536\u5230\u7528\u6237\u8bf7\u6c42\u65f6\uff0c\u6846\u67b6\u4f1a\u5b9e\u4f8b\u5316\u4e00\u4e2a Context \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5c01\u88c5\u4e86\u8fd9\u6b21\u7528\u6237\u8bf7\u6c42\u7684\u4fe1\u606f\uff0c\u5e76\u63d0\u4f9b\u4e86\u8bb8\u591a\u4fbf\u6377\u7684\u65b9\u6cd5\u6765\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570\u6216\u8005\u8bbe\u7f6e\u54cd\u5e94\u4fe1\u606f\u3002\u6846\u67b6\u4f1a\u5c06\u6240\u6709\u7684 Service \u6302\u8f7d\u5230 Context \u5b9e\u4f8b\u4e0a\uff0c\u4e00\u4e9b\u63d2\u4ef6\u4e5f\u4f1a\u5c06\u4e00\u4e9b\u5176\u4ed6\u7684\u65b9\u6cd5\u548c\u5bf9\u8c61\u6302\u8f7d\u5230\u5b83\u4e0a\u9762\uff08egg-sequelize \u4f1a\u5c06\u6240\u6709\u7684 model \u6302\u8f7d\u5728 Context \u4e0a\uff09"),(0,a.kt)("h3",{id:"\u83b7\u53d6\u65b9\u5f0f-1"},"\u83b7\u53d6\u65b9\u5f0f"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Controller \u4e2d\u7684\u83b7\u53d6\u65b9\u5f0f\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u5df2\u7ecf\u5c55\u793a\u8fc7\u4e86"),(0,a.kt)("li",{parentName:"ul"},"\u5728 Service \u4e2d\u83b7\u53d6\u548c Controller \u4e2d\u83b7\u53d6\u7684\u65b9\u5f0f\u4e00\u6837\uff0c"),(0,a.kt)("li",{parentName:"ul"},"\u5728 Middleware \u4e2d\u83b7\u53d6 Context \u5b9e\u4f8b\u5219\u548c Koa \u6846\u67b6\u5728\u4e2d\u95f4\u4ef6\u4e2d\u83b7\u53d6 Context \u5bf9\u8c61\u7684\u65b9\u5f0f\u4e00\u81f4")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    this.ctx.body = xxxx\n    xxx\n  }\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// Koa v1\nfunction* middleware(next) {\n  // this is instance of Context\n  console.log(this.query)\n  yield next\n}\n\n// Koa v2\nasync function middleware(ctx, next) {\n  // ctx is instance of Context\n  console.log(ctx.query)\n}\n")),(0,a.kt)("p",null,"\u9664\u4e86\u5728\u8bf7\u6c42\u65f6\u53ef\u4ee5\u83b7\u53d6 Context \u5b9e\u4f8b\u4e4b\u5916\uff0c \u5728\u6709\u4e9b\u975e\u7528\u6237\u8bf7\u6c42\u7684\u573a\u666f\u4e0b\u6211\u4eec\u9700\u8981\u8bbf\u95ee service / model \u7b49 Context \u5b9e\u4f8b\u4e0a\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Application.createAnonymousContext() \u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u533f\u540d Context \u5b9e\u4f8b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    const ctx = app.createAnonymousContext()\n    // preload before app start\n    await ctx.service.posts.load()\n  })\n}\n")),(0,a.kt)("p",null,"\u5728\u5b9a\u65f6\u4efb\u52a1\u4e2d\u7684\u6bcf\u4e00\u4e2a task \u90fd\u63a5\u53d7\u4e00\u4e2a Context \u5b9e\u4f8b\u4f5c\u4e3a\u53c2\u6570\uff0c\u4ee5\u4fbf\u6211\u4eec\u66f4\u65b9\u4fbf\u7684\u6267\u884c\u4e00\u4e9b\u5b9a\u65f6\u7684\u4e1a\u52a1\u903b\u8f91\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/schedule/refresh.js\nexports.task = async (ctx) => {\n  await ctx.service.posts.refresh()\n}\n")),(0,a.kt)("h3",{id:"request--response"},"Request & Response"),(0,a.kt)("p",null,"Request \u7ee7\u627f\u81ea Koa.Request\uff0cResponse \u7ee7\u627f\u81ea Koa.Response"),(0,a.kt)("p",null,"\u53ef\u4ee5\u5728 Context \u7684\u5b9e\u4f8b\u4e0a\u83b7\u53d6\u5230\u5f53\u524d\u8bf7\u6c42\u7684 Request(ctx.request) \u548c Response(ctx.response) \u5b9e\u4f8b\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    const { app, ctx } = this\n    const id = ctx.request.query.id\n    ctx.response.body = app.cache.get(id)\n  }\n}\n")),(0,a.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u63d0\u793a")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("ul",{parentName:"div"},(0,a.kt)("li",{parentName:"ul"},"Koa \u4f1a\u5728 Context \u4e0a\u4ee3\u7406\u4e00\u90e8\u5206 Request \u548c Response \u4e0a\u7684\u65b9\u6cd5\u548c\u5c5e\u6027\uff0c\u53c2\u89c1 Koa.Context\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5982\u4e0a\u9762\u4f8b\u5b50\u4e2d\u7684 ctx.request.query.id \u548c ctx.query.id \u662f\u7b49\u4ef7\u7684\uff0cctx.response.body= \u548c ctx.body= \u662f\u7b49\u4ef7\u7684\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u6ce8\u610f"),"\uff0c\u83b7\u53d6 POST \u7684 body \u5e94\u8be5\u4f7f\u7528 ",(0,a.kt)("strong",{parentName:"li"},"ctx.request.body"),"\uff0c\u800c\u4e0d\u662f ctx.body\u3002")))),(0,a.kt)("h3",{id:"controller"},"Controller"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ctx - \u5f53\u524d\u8bf7\u6c42\u7684 Context \u5b9e\u4f8b\u3002"),(0,a.kt)("li",{parentName:"ul"},"app - \u5e94\u7528\u7684 Application \u5b9e\u4f8b\u3002"),(0,a.kt)("li",{parentName:"ul"},"config - \u5e94\u7528\u7684\u914d\u7f6e\u3002"),(0,a.kt)("li",{parentName:"ul"},"service - \u5e94\u7528\u6240\u6709\u7684 service\u3002"),(0,a.kt)("li",{parentName:"ul"},"logger - \u4e3a\u5f53\u524d controller \u5c01\u88c5\u7684 logger \u5bf9\u8c61\u3002")),(0,a.kt)("p",null,"\u5728 Controller \u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u6765\u5f15\u7528 Controller \u57fa\u7c7b"),(0,a.kt)("p",null,"\u63a8\u8350\u4f7f\u7528\u4ece egg \u4e0a\u83b7\u53d6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/controller/user.js\n\n// \u4ece egg \u4e0a\u83b7\u53d6\uff08\u63a8\u8350\uff09\nconst Controller = require('egg').Controller\nclass UserController extends Controller {\n  // implement\n  async user() {\n    //   this.ctx\n    //   this.app\n    console.log(this.config.keys)\n    this.ctx.body = {\n      status: 0,\n      user: await this.service.user.findUser(1)\n    }\n  }\n}\nmodule.exports = UserController\n\n// \u4ece app \u5b9e\u4f8b\u4e0a\u83b7\u53d6\nmodule.exports = (app) => {\n  return class UserController extends app.Controller {\n    // implement\n    // app.ctx\n  }\n}\n")),(0,a.kt)("h3",{id:"service"},"Service"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/service/user.js\n\n// \u4ece egg \u4e0a\u83b7\u53d6\uff08\u63a8\u8350\uff09\nconst Service = require('egg').Service\nclass UserService extends Service {\n  // implement\n  async findUser(id) {\n    //   xxxx\n    console.log(this.ctx.xxx)\n  }\n}\nmodule.exports = UserService\n\n// \u4ece app \u5b9e\u4f8b\u4e0a\u83b7\u53d6\nmodule.exports = (app) => {\n  return class UserService extends app.Service {\n    // implement\n  }\n}\n")),(0,a.kt)("h3",{id:"helper"},"Helper"),(0,a.kt)("p",null,"Helper \u7528\u6765\u63d0\u4f9b\u4e00\u4e9b\u5b9e\u7528\u7684 utility \u51fd\u6570\u3002\u5b83\u7684\u4f5c\u7528\u5728\u4e8e\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e9b\u5e38\u7528\u7684\u52a8\u4f5c\u62bd\u79bb\u5728 helper.js \u91cc\u9762\u6210\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u51fd\u6570\uff0c\u8fd9\u6837\u53ef\u4ee5\u7528 JavaScript \u6765\u5199\u590d\u6742\u7684\u903b\u8f91\uff0c\u907f\u514d\u903b\u8f91\u5206\u6563\u5404\u5904\uff0c\u540c\u65f6\u53ef\u4ee5\u66f4\u597d\u7684\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u3002"),(0,a.kt)("p",null,"Helper \u81ea\u8eab\u662f\u4e00\u4e2a\u7c7b\uff0c\u6709\u548c Controller \u57fa\u7c7b\u4e00\u6837\u7684\u5c5e\u6027\uff0c\u5b83\u4e5f\u4f1a\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u8fdb\u884c\u5b9e\u4f8b\u5316\uff0c\u56e0\u6b64 Helper \u4e0a\u7684\u6240\u6709\u51fd\u6570\u4e5f\u80fd\u83b7\u53d6\u5230\u5f53\u524d\u8bf7\u6c42\u76f8\u5173\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class UserController extends Controller {\n  async fetch() {\n    ...\n    ctx.body = ctx.helper.format(xxx)\n  }\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// app/extend/helper.js\nmodule.exports = {\n  format() {\n    xxx\n    return xxx\n  }\n}\n")))}d.isMDXComponent=!0}}]);